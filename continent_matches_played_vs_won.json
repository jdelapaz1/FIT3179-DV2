{
  "$schema": "https://vega.github.io/schema/vega-lite/v6.json",
  "description": "Scatterplot of total matches played vs average win percentage by country, colored by continent.",
  "autosize": {
    "type": "fit",
    "contains": "padding"
    },
  "data": {
    "url": "Players_With_Contintents.csv",
    "format": {"type": "csv"}
  },
  "transform": [
    {
      "aggregate": [
        {"op": "sum", "field": "matches_played", "as": "total_matches_played"},
        {"op": "sum", "field": "match_wins", "as": "total_match_wins"}
      ],
      "groupby": ["country", "Continent"]
    },
    {
      "calculate": "datum.total_match_wins / datum.total_matches_played",
      "as": "avg_win_percentage"
    }
  ],
  "params": [
    {
      "name": "continentSel",
      "select": {"type": "point", "fields": ["Continent"]},
      "bind": "legend"
    }
  ],
  "mark": {"type": "point", "filled": true, "size": 300},
  "encoding": {
    "x": {
      "field": "total_matches_played",
      "type": "quantitative",
      "title": "Matches Played",
      "scale": {"zero": false}
    },
    "y": {
      "field": "avg_win_percentage",
      "type": "quantitative",
      "title": "Average Win Percentage",
      "axis": {"format": ".0%"},
      "scale": {"zero": false}
    },
    "color": {
        "field": "Continent", 
        "type": "nominal", 
        "title": "Continent",
        "scale": {
        "domain": ["Africa","Asia","Europe","North America","Oceania","South America"],
        "range":  ["#32292F","#6D3D14","#61988E","#8E7C93","#705D56","#1D3461"]  
      },
        "legend": {
            "orient": "bottom-right",
            "direction": "vertical",
            "titleOrient": "top",
            "offset": 50
        }
    },
    "opacity": {
      "condition": {"param": "continentSel", "value": 1},
      "value": 0
    },
    "tooltip": [
      {"field": "country", "type": "nominal", "title": "Country"},
      {"field": "Continent", "type": "nominal", "title": "Continent"},
      {"field": "total_matches_played", "type": "quantitative", "title": "Matches Played"},
      {"field": "avg_win_percentage", "type": "quantitative", "title": "Average Win Percentage", "format": ".1%"}
    ]
  },
  "width": "container",
  "height": "container",
  "title": "ATP Players by Country: Matches Played vs Average Win Percentage"
}
