{
  "$schema": "https://vega.github.io/schema/vega-lite/v6.json",
  "description": "ATP tournaments held in 2024 with tournament type filter.",
  "width": "container",
  "height": "container",
  "autosize": {"type": "fit", "contains": "padding"},
  "padding": {"left": 0, "top": 0, "right": 0, "bottom": 0},
  "config": {
    "view": {"stroke": null},
    "legend": {"titleFontSize": 12, "labelFontSize": 11}
  },

  "projection": {"type": "equirectangular"},

  "layer": [
    {
      "name": "world",
      "data": {
        "url": "https://vega.github.io/vega-datasets/data/world-110m.json",
        "format": {"type": "topojson", "feature": "countries"}
      },
      "mark": {"type": "geoshape", "fill": "#f6f6f6", "stroke": "#bdbdbd", "strokeWidth": 0.5}
    },
    {
  "name": "tournaments",
  "data": {"url": "atp_tournaments_2024 copy.csv"},
  "transform": [
    { "filter": "toDate(datum.Date) == null ? true : year(toDate(datum.Date)) == 2024" },
    {
      "calculate": "datum.Series === 'ATP250' ? 'ATP 250' : datum.Series === 'ATP500' ? 'ATP 500' : datum.Series === 'Masters 1000' ? 'ATP 1000' : datum.Series === 'Masters Cup' ? 'ATP Finals' : datum.Series",
      "as": "SeriesPretty"
    },
    { "aggregate": [], "groupby": ["Tournament", "city_ascii", "country", "SeriesPretty", "lat", "lng"] }
  ],

  "params": [
    {
      "name": "seriesLegend",
      "select": { "type": "point", "encodings": ["color"] },
      "bind": "legend"
    }
  ],

  "mark": {"type": "circle", "opacity": 1, "size": 150},

  "encoding": {
    "longitude": {"field": "lng", "type": "quantitative"},
    "latitude": {"field": "lat", "type": "quantitative"},

    "color": {
      "field": "SeriesPretty",
      "type": "nominal",
      "title": "Tournament Type",
      "legend": {
        "orient": "top-left",
        "direction": "vertical",
        "columns": 1,
        "symbolType": "circle",
        "labelColor": "black",
        "titleColor": "black",
        "offset": 150
      },
      "scale": {
        "domain": ["ATP 250", "ATP 500", "ATP 1000", "ATP Finals", "Grand Slam"],
        "range":  ["#cd7f32", "#262627", "#ffd700", "#003366", "#4b0082"]
      }
    },

    "opacity": {
      "condition": { "param": "seriesLegend", "value": 1 },
      "value": 0
    },
    "strokeWidth": {
      "condition": { "param": "seriesLegend", "value": 1.5 },
      "value": 0
    },

    "tooltip": [
      {"field": "Tournament", "type": "nominal", "title": "Tournament"},
      {"field": "city_ascii", "type": "nominal", "title": "City"},
      {"field": "country", "type": "nominal", "title": "Country"},
      {"field": "SeriesPretty", "type": "nominal", "title": "Type"}
    ]
  }
},
    {
      "name": "annotation_sa",
      "layer": [
        {
          "mark": { "type": "line", "stroke": "#1f2937", "strokeDash": [3, 3] },
          "encoding": {
            "longitude": { "field": "lon", "type": "quantitative" },
            "latitude":  { "field": "lat", "type": "quantitative" },
            "detail":    { "field": "id" }
          }
        },
        {
          "transform": [
            {
              "aggregate": [
                { "op": "min", "field": "lon", "as": "lon" },
                { "op": "min", "field": "lat", "as": "lat" },
                { "op": "max", "field": "label", "as": "label" }
              ],
              "groupby": ["id"]
            }
          ],
          "mark": {
            "type": "text",
            "align": "left",
            "font": "Archivo Black",
            "fontSize": 8,
            "fill": "#111",
            "stroke": "black",
            "strokeWidth": 3,
            "dx": 6,
            "dy": -6
          },
          "encoding": {
            "longitude": { "field": "lon", "type": "quantitative" },
            "latitude":  { "field": "lat", "type": "quantitative" },
            "text":      { "field": "label" }
          }
        }
      ]
    }
  ]
}
